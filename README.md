# Blockchain info API

Simple REST-like API generated by go-swagger.

1. Using `github.com/jackc/tern` to manage migrations.
2. Using `redis` to cache responses.
3. Using `postgresql` as a main database.

For API customization use [`restapi/configure_blockchain_info.go`](https://github.com/cegorah/blockchain_info/blob/master/restapi/configure_blockchain_info.go).  
For more details please follow the [link](https://goswagger.io/tutorial/custom-server.html).

`handlers` package is using to define handlers that contain main endpoints logic.

## Endpoints

* `v1/block/{net_code}/{hash}` returns information about a certain block and related transactions.
* `v1/tx/{net_code}/{hash}` returns information about transactions with a block with the `hash`.
* `api/help` provide an API documentation.

## Configuration

The secrets that are using for services initialization provides by ENVs.  
For docker run the `.env` file will be using.  
For local launch you should provide `PSQL_DSN`, `REDIS_USERNAME` and `REDIS_PASSWORD` via env variables.  
`DEBUG (bool)` is using for get more information in app's logs.

Services runtime configuration is providing with `./config/config.json`.

### Config parameters

* `services` - describes a whole service configuration section
    * `init_timeout` - timeout in seconds that will be using to service initialization
    * `query_timeout` - timeout in seconds that will be using for query
    * `redis` - describes redis configuration section
        * `connection_string` - URL of the service
        * `db` - default database to connect
        * `ttl` - default TTL in secondes to store the cache.

### Env parameters

`REDIS_USERNAME=admin`  
`REDIS_PASSWORD=admin`  
`PSQL_DSN=postgres://admin_username:admin_password@localhost:5432/admin_db`  
`DEBUG=false`

## Docker run

Run `docker-compose up -d` to launch all dependent containers: redis, psql and nginx.  
`.env` will be use for secrets' providing.

## Local run

Launch `/bin/bash run.sh`.  
The server will be listening on `localhost:8080`.  
In that scenario you have to provide right credentials to external services (redis, psql).

## TODO

* JWT authorization token through middleware
* CI/CD pipelines